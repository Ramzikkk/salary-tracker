<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞—Ä–ø–ª–∞—Ç—ã</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .fade-in { animation: fadeIn 0.5s ease-out; }
        .slide-in { animation: slideIn 0.5s ease-out; }
        .pulse-once { animation: pulse 0.6s ease-out; }
        
        /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã */
        * { transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
        
        /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
        .dark { background: #0f172a; color: #e2e8f0; }
        .dark .bg-white { background: #1e293b; }
        .dark .bg-gray-50 { background: #334155; }
        .dark .bg-gray-100 { background: #1e293b; }
        .dark .bg-gray-200 { background: #334155; }
        .dark .text-gray-800 { color: #e2e8f0; }
        .dark .text-gray-700 { color: #cbd5e1; }
        .dark .text-gray-600 { color: #94a3b8; }
        .dark .border-gray-200 { border-color: #334155; }
        .dark .border-gray-300 { border-color: #475569; }
        .dark input, .dark select { background: #334155; color: #e2e8f0; border-color: #475569; }
        .dark input::placeholder { color: #64748b; }
        
        /* Hover —ç—Ñ—Ñ–µ–∫—Ç—ã */
        .hover-lift { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .hover-lift:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2); }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-900 dark:to-gray-800 min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8 max-w-7xl"></div>

    <script type="module">
        let darkMode = localStorage.getItem('darkMode') === 'true';
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, where, setDoc, getDoc, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const MANAGER_EMAIL = "gcsalary@gmail.com";

        const firebaseConfig = {
            apiKey: "AIzaSyBxCYvHpwC37-NuQ_-iNhNpiApS7_qfQps",
            authDomain: "salary-tracker-b3e7f.firebaseapp.com",
            projectId: "salary-tracker-b3e7f",
            storageBucket: "salary-tracker-b3e7f.firebasestorage.app",
            messagingSenderId: "309704635672",
            appId: "1:309704635672:web:510375311149bac6701a6d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let userProfile = null;
        let shifts = [];
        let deductions = [];
        let bonuses = [];
        let allBaristas = [];
        let selectedMonth = 'all';
        let selectedBaristaId = 'all';
        let selectedLocation = 'all';
        let showSettings = false;

        const LOCATIONS = {
            boxpark: { 
                name: '–ë–æ–∫—Å –ø–∞—Ä–∫', 
                fullHours: 15, 
                weekdaySalary: 10000,
                weekendSalary: 10000
            },
            aport: { 
                name: '–ê–ø–æ—Ä—Ç', 
                fullHours: 14, 
                weekdaySalary: 9000,
                weekendSalary: 10000
            },
            saryarka: { 
                name: '–°–∞—Ä—ã –∞—Ä–∫–∞', 
                fullHours: 18, 
                weekdaySalary: 13000,
                weekendSalary: 13000
            }
        };

        let userSettings = {
            cashPercent: 3,
            customSalaries: {
                boxpark: { weekday: null, weekend: null },
                aport: { weekday: null, weekend: null },
                saryarka: { weekday: null, weekend: null }
            }
        };
        let editingBaristaId = null;
        let editingBaristaSettings = null;
        let editingBaristaName = null;

        // === WINDOW FUNCTIONS ===
        window.register = register;
        window.login = login;
        window.logout = logout;
        window.addShift = addShift;
        window.deleteShift = deleteShift;
        window.addDeduction = addDeduction;
        window.deleteDeduction = deleteDeduction;
        window.addBonus = addBonus;
        window.deleteBonus = deleteBonus;
        window.toggleSettings = toggleSettings;
        window.updateCashPercent = updateCashPercent;
        window.updateCustomSalary = updateCustomSalary;
        window.saveUserSettings = saveUserSettings;
        window.changeMonth = changeMonth;
        window.changeBarista = changeBarista;
        window.changeLocation = changeLocation;
        window.openBaristaSettings = openBaristaSettings;
        window.updateBaristaSettings = updateBaristaSettings;
        window.updateBaristaName = updateBaristaName;
        window.saveBaristaSettings = saveBaristaSettings;
        window.closeBaristaSettings = closeBaristaSettings;
        window.updateTimeFromSlider = updateTimeFromSlider;
        window.toggleDarkMode = toggleDarkMode;

        function getAnalytics(shiftsArray) {
            const last7Days = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayShifts = shiftsArray.filter(s => s.date === dateStr);
                const dayEarnings = dayShifts.reduce((sum, s) => 
                    sum + s.hourlySalary + s.cashBonus + (s.autoBonus || 0), 0);
                
                last7Days.push({
                    date: dateStr,
                    shifts: dayShifts.length,
                    earnings: dayEarnings
                });
            }
            
            // –°—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
            const avgShiftsPerDay = shiftsArray.length / 30 || 0;
            const totalEarnings = shiftsArray.reduce((sum, s) => 
                sum + s.hourlySalary + s.cashBonus + (s.autoBonus || 0), 0);
            const avgEarningsPerShift = shiftsArray.length ? totalEarnings / shiftsArray.length : 0;
            
            // –õ—É—á—à–∏–π –¥–µ–Ω—å
            const bestDay = last7Days.reduce((best, day) => 
                day.earnings > (best?.earnings || 0) ? day : best, null);
            
            return {
                last7Days,
                avgShiftsPerDay: avgShiftsPerDay.toFixed(1),
                avgEarningsPerShift: avgEarningsPerShift.toFixed(0),
                bestDay
            };
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', darkMode);
            applyDarkMode();
            render(); // ‚Üê –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£
        }

        function applyDarkMode() {
            if (darkMode) {
                document.body.classList.add('dark');
            } else {
                document.body.classList.remove('dark');
            }
        }

        // === AUTH ===
        async function register() {
            const email = document.getElementById('auth-email').value.trim();
            const password = document.getElementById('auth-password').value;
            const name = document.getElementById('auth-name').value.trim();

            if (!email || !password || !name) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            if (password.length < 6) {
                alert('‚ùå –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤!');
                return;
            }

            try {
                const role = email.toLowerCase() === MANAGER_EMAIL.toLowerCase() ? 'manager' : 'barista';
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                await setDoc(doc(db, 'users', user.uid), {
                    name: name,
                    email: email,
                    role: role,
                    createdAt: new Date().toISOString()
                });

                await setDoc(doc(db, 'userSettings', user.uid), userSettings);
                alert(`‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –†–æ–ª—å: ${role === 'manager' ? '–ú–µ–Ω–µ–¥–∂–µ—Ä' : '–ë–∞—Ä–∏—Å—Ç–∞'}`);
            } catch (error) {
                if (error.code === 'auth/email-already-in-use') {
                    alert('‚ùå –≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!');
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                }
            }
        }

        async function login() {
            const email = document.getElementById('auth-email').value.trim();
            const password = document.getElementById('auth-password').value;

            if (!email || !password) {
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                if (error.code === 'auth/invalid-credential') {
                    alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
                } else if (error.code === 'auth/user-not-found') {
                    alert('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                } else if (error.code === 'auth/wrong-password') {
                    alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                } else if (error.code === 'auth/too-many-requests') {
                    alert('‚ùå –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
                }
            }
        }

        async function logout() {
            if (!confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) return;
            try {
                await signOut(auth);
                currentUser = null;
                userProfile = null;
                shifts = [];
                deductions = [];
                bonuses = [];
                selectedMonth = 'all';
                selectedBaristaId = 'all';
                showSettings = false;
                render();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞: ' + error.message);
            }
        }

        async function loadUserProfile() {
            if (!currentUser) return;
            const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
            if (userDoc.exists()) {
                userProfile = { id: currentUser.uid, ...userDoc.data() };
            }
        }

        async function loadUserSettings() {
            if (!currentUser) return;
            const settingsDoc = await getDoc(doc(db, 'userSettings', currentUser.uid));
            if (settingsDoc.exists()) {
                userSettings = settingsDoc.data();
                // Ensure customSalaries exists
                if (!userSettings.customSalaries) {
                    userSettings.customSalaries = {
                        boxpark: null,
                        aport: null,
                        saryarka: null
                    };
                }
            } else {
                await setDoc(doc(db, 'userSettings', currentUser.uid), userSettings);
            }
        }

        // === DATA ===
        async function loadData() {
            if (!currentUser || !userProfile) return;

            if (userProfile.role === 'manager') {
                await loadAllBaristas();
                await loadAllShifts();
                await loadAllDeductions();
                await loadAllBonuses();
            } else {
                await loadMyShifts();
                await loadMyDeductions();
                await loadMyBonuses();
            }

            render();
        }

        async function loadAllBaristas() {
            const q = query(collection(db, 'users'), where('role', '==', 'barista'));
            const snapshot = await getDocs(q);
            allBaristas = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        async function loadAllShifts() {
            const q = query(collection(db, 'shifts'), orderBy('date', 'desc'));
            const snapshot = await getDocs(q);
            shifts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        async function loadAllDeductions() {
            const snapshot = await getDocs(collection(db, 'deductions'));
            deductions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        async function loadAllBonuses() {
            const snapshot = await getDocs(collection(db, 'bonuses'));
            bonuses = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        async function loadMyShifts() {
            const q = query(
                collection(db, 'shifts'),
                where('userId', '==', currentUser.uid),
                orderBy('date', 'desc')
            );
            const snapshot = await getDocs(q);
            shifts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        async function loadMyDeductions() {
            const q = query(collection(db, 'deductions'), where('userId', '==', currentUser.uid));
            const snapshot = await getDocs(q);
            deductions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        async function loadMyBonuses() {
            const q = query(collection(db, 'bonuses'), where('userId', '==', currentUser.uid));
            const snapshot = await getDocs(q);
            bonuses = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        function calculateHours(start, end) {
            const [startH, startM] = start.split(':').map(Number);
            const [endH, endM] = end.split(':').map(Number);
            let startMinutes = startH * 60 + startM;
            let endMinutes = endH * 60 + endM;
            if (endMinutes <= startMinutes) {
                endMinutes += 24 * 60;
            }
            return (endMinutes - startMinutes) / 60;
        }

        async function addShift() {
            const date = document.getElementById('shift-date').value;
            const locationKey = document.getElementById('shift-location').value;
            const startTime = document.getElementById('shift-start').value;
            const endTime = document.getElementById('shift-end').value;
            const cash = parseFloat(document.getElementById('shift-cash').value) || 0;

            if (!date || !startTime || !endTime) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è!');
                return;
            }

            const hours = calculateHours(startTime, endTime);
            
            if (hours <= 0 || hours > 24) {
                alert('‚ùå –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è —Å–º–µ–Ω—ã!');
                return;
            }

            const location = LOCATIONS[locationKey];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (0 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 5 = –ø—è—Ç–Ω–∏—Ü–∞, 6 = —Å—É–±–±–æ—Ç–∞)
            const dayOfWeek = new Date(date).getDay();
            const isWeekend = dayOfWeek === 0 || dayOfWeek === 5 || dayOfWeek === 6; // –ü—è—Ç–Ω–∏—Ü–∞, –°—É–±–±–æ—Ç–∞, –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
            
            // Ensure customSalaries exists with new structure
            if (!userSettings.customSalaries) {
                userSettings.customSalaries = {
                    boxpark: { weekday: null, weekend: null },
                    aport: { weekday: null, weekend: null },
                    saryarka: { weekday: null, weekend: null }
                };
            }
            
            // Ensure location has both salary types
            if (!userSettings.customSalaries[locationKey]) {
                userSettings.customSalaries[locationKey] = { weekday: null, weekend: null };
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ–∫–ª–∞–¥
            let baseSalary;
            if (isWeekend) {
                const customWeekendSalary = userSettings.customSalaries[locationKey].weekend;
                baseSalary = customWeekendSalary !== null ? customWeekendSalary : location.weekendSalary;
            } else {
                const customWeekdaySalary = userSettings.customSalaries[locationKey].weekday;
                baseSalary = customWeekdaySalary !== null ? customWeekdaySalary : location.weekdaySalary;
            }
            
            const hourlyRate = baseSalary / location.fullHours;
            const hourlySalary = hourlyRate * hours;
            const cashBonus = cash * (userSettings.cashPercent / 100);
            
            let autoBonus = 0;
            if (locationKey === 'saryarka' && cash >= 160000) {
                autoBonus = 2000;
            }

            const shiftData = {
                userId: currentUser.uid,
                userName: userProfile.name,
                date: date,
                locationKey: locationKey,
                locationName: location.name,
                startTime: startTime,
                endTime: endTime,
                hours: hours,
                cash: cash,
                hourlySalary: hourlySalary,
                cashBonus: cashBonus,
                autoBonus: autoBonus,
                cashPercent: userSettings.cashPercent,
                baseSalary: baseSalary,
                isWeekend: isWeekend,
                createdAt: new Date().toISOString()
            };

            try {
                await addDoc(collection(db, 'shifts'), shiftData);
                document.getElementById('shift-cash').value = '';
                document.getElementById('shift-start').value = '';
                document.getElementById('shift-end').value = '';
                
                const dayType = isWeekend ? '–í—ã—Ö–æ–¥–Ω–æ–π' : '–ë—É–¥–Ω–∏–π';
                if (autoBonus > 0) {
                    alert(`‚úÖ –°–º–µ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞! (${dayType} –¥–µ–Ω—å)\nüéÅ –ë–æ–Ω—É—Å –∑–∞ –∫–∞—Å—Å—É: ${autoBonus}‚Ç∏`);
                } else {
                    alert(`‚úÖ –°–º–µ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞! (${dayType} –¥–µ–Ω—å)`);
                }
                
                await loadData();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function deleteShift(id) {
            if (!confirm('‚ùå –£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å–º–µ–Ω—É?')) return;
            try {
                await deleteDoc(doc(db, 'shifts', id));
                await loadData();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function addDeduction() {
            const name = document.getElementById('deduction-name').value.trim();
            const amount = parseFloat(document.getElementById('deduction-amount').value);

            if (!name || !amount || amount <= 0) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!');
                return;
            }

            const monthKey = selectedMonth === 'all' ? new Date().toISOString().slice(0, 7) : selectedMonth;

            const deductionData = {
                userId: currentUser.uid,
                userName: userProfile.name,
                name: name,
                amount: amount,
                month: monthKey,
                createdAt: new Date().toISOString()
            };

            try {
                await addDoc(collection(db, 'deductions'), deductionData);
                document.getElementById('deduction-name').value = '';
                document.getElementById('deduction-amount').value = '';
                alert('‚úÖ –í—ã—á–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω!');
                await loadData();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function deleteDeduction(id) {
            if (!confirm('‚ùå –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤—ã—á–µ—Ç?')) return;
            try {
                await deleteDoc(doc(db, 'deductions', id));
                await loadData();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function addBonus() {
            const name = document.getElementById('bonus-name').value.trim();
            const amount = parseFloat(document.getElementById('bonus-amount').value);

            if (!name || !amount || amount <= 0) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!');
                return;
            }

            const monthKey = selectedMonth === 'all' ? new Date().toISOString().slice(0, 7) : selectedMonth;

            const bonusData = {
                userId: currentUser.uid,
                userName: userProfile.name,
                name: name,
                amount: amount,
                month: monthKey,
                createdAt: new Date().toISOString()
            };

            try {
                await addDoc(collection(db, 'bonuses'), bonusData);
                document.getElementById('bonus-name').value = '';
                document.getElementById('bonus-amount').value = '';
                alert('‚úÖ –ü—Ä–µ–º–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
                await loadData();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function deleteBonus(id) {
            if (!confirm('‚ùå –£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–µ–º–∏—é?')) return;
            try {
                await deleteDoc(doc(db, 'bonuses', id));
                await loadData();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        // === SETTINGS ===
        function toggleSettings() {
            showSettings = !showSettings;
            render();
        }

        function updateCashPercent(value) {
            userSettings.cashPercent = parseFloat(value);
        }

        function updateCustomSalary(locationKey, dayType, value) {
            const numValue = value === '' ? null : parseFloat(value);
            if (!userSettings.customSalaries) {
                userSettings.customSalaries = {
                    boxpark: { weekday: null, weekend: null },
                    aport: { weekday: null, weekend: null },
                    saryarka: { weekday: null, weekend: null }
                };
            }
            if (!userSettings.customSalaries[locationKey]) {
                userSettings.customSalaries[locationKey] = { weekday: null, weekend: null };
            }
            userSettings.customSalaries[locationKey][dayType] = numValue;
        }

        async function saveUserSettings() {
            try {
                await setDoc(doc(db, 'userSettings', currentUser.uid), userSettings);
                alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                showSettings = false;
                render();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function openBaristaSettings(baristaId) {
            editingBaristaId = baristaId;
            const barista = allBaristas.find(b => b.id === baristaId);
            editingBaristaName = barista.name;
            loadBaristaSettings(baristaId);
        }

        async function loadBaristaSettings(baristaId) {
            const settingsDoc = await getDoc(doc(db, 'userSettings', baristaId));
            if (settingsDoc.exists()) {
                editingBaristaSettings = settingsDoc.data();
                // Ensure customSalaries exists
                if (!editingBaristaSettings.customSalaries) {
                    editingBaristaSettings.customSalaries = {
                        boxpark: null,
                        aport: null,
                        saryarka: null
                    };
                }
            } else {
                editingBaristaSettings = {
                    cashPercent: 3,
                    customSalaries: {
                        boxpark: null,
                        aport: null,
                        saryarka: null
                    }
                };
            }
            render();
        }

        function updateBaristaSettings(field, dayType, value) {
            if (field === 'cashPercent') {
                editingBaristaSettings.cashPercent = parseFloat(value);
            } else {
                const numValue = value === '' ? null : parseFloat(value);
                if (!editingBaristaSettings.customSalaries[field]) {
                    editingBaristaSettings.customSalaries[field] = { weekday: null, weekend: null };
                }
                editingBaristaSettings.customSalaries[field][dayType] = numValue;
            }
        }

        function updateBaristaName(newName) {
            editingBaristaName = newName.trim();
        }

        async function saveBaristaSettings() {
            if (!editingBaristaId) return;
            try {
                await setDoc(doc(db, 'userSettings', editingBaristaId), editingBaristaSettings);
                
                if (editingBaristaName) {
                    await setDoc(doc(db, 'users', editingBaristaId), {
                        name: editingBaristaName
                    }, { merge: true });
                }
                
                alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∏–º—è –±–∞—Ä–∏—Å—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                editingBaristaId = null;
                editingBaristaSettings = null;
                editingBaristaName = null;
                await loadData();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function closeBaristaSettings() {
            editingBaristaId = null;
            editingBaristaSettings = null;
            editingBaristaName = null;
            render();
        }

        function updateTimeFromSlider(field, value) {
            const hours = Math.floor(value / 60);
            const minutes = value % 60;
            const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            document.getElementById(field).value = timeString;
        }

        // === FILTERS & STATS ===
        function changeMonth(month) {
            selectedMonth = month;
            render();
        }

        function changeLocation(location) {
            selectedLocation = location;
            render();
        }

        function changeBarista(baristaId) {
            selectedBaristaId = baristaId;
            render();
        }

        function getAvailableMonths(shiftsArray) {
            const months = new Set(shiftsArray.map(s => s.date.slice(0, 7)));
            return Array.from(months).sort().reverse();
        }

        function filterShiftsByMonth(shiftsArray, month) {
            if (month === 'all') return shiftsArray;
            return shiftsArray.filter(s => s.date.startsWith(month));
        }

        function filterDeductionsByMonth(deductionsArray, month) {
            if (month === 'all') return deductionsArray;
            return deductionsArray.filter(d => d.month === month);
        }

        function filterBonusesByMonth(bonusesArray, month) {
            if (month === 'all') return bonusesArray;
            return bonusesArray.filter(b => b.month === month);
        }

        function filterShiftsByBarista(shiftsArray, baristaId) {
            if (baristaId === 'all') return shiftsArray;
            return shiftsArray.filter(s => s.userId === baristaId);
        }

        function getMonthName(monthKey) {
            if (monthKey === 'all') return '–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞';
            const months = ['—è–Ω–≤', '—Ñ–µ–≤', '–º–∞—Ä', '–∞–ø—Ä', '–º–∞–π', '–∏—é–Ω', '–∏—é–ª', '–∞–≤–≥', '—Å–µ–Ω', '–æ–∫—Ç', '–Ω–æ—è', '–¥–µ–∫'];
            const [year, month] = monthKey.split('-');
            return `${months[parseInt(month) - 1]} ${year}`;
        }

        function getStatsByLocation(shiftsArray) {
            const stats = {};
            shiftsArray.forEach(shift => {
                const key = shift.locationKey || 'unknown';
                if (!stats[key]) {
                    stats[key] = {
                        name: shift.locationName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                        shifts: 0,
                        hours: 0,
                        cash: 0,
                        hourlySalary: 0,
                        cashBonus: 0,
                        autoBonus: 0,
                        total: 0
                    };
                }
                stats[key].shifts++;
                stats[key].hours += shift.hours;
                stats[key].cash += shift.cash;
                stats[key].hourlySalary += shift.hourlySalary;
                stats[key].cashBonus += shift.cashBonus;
                stats[key].autoBonus += shift.autoBonus || 0;
                stats[key].total += shift.hourlySalary + shift.cashBonus + (shift.autoBonus || 0);
            });
            return stats;
        }

        function getTotals(shiftsArray, deductionsArray, bonusesArray) {
            const totalShifts = shiftsArray.length;
            const totalHours = shiftsArray.reduce((sum, s) => sum + s.hours, 0);
            const totalCash = shiftsArray.reduce((sum, s) => sum + s.cash, 0);
            const totalHourlySalary = shiftsArray.reduce((sum, s) => sum + s.hourlySalary, 0);
            const totalCashBonus = shiftsArray.reduce((sum, s) => sum + s.cashBonus, 0);
            const totalAutoBonus = shiftsArray.reduce((sum, s) => sum + (s.autoBonus || 0), 0);
            const totalBonuses = bonusesArray.reduce((sum, b) => sum + b.amount, 0);
            const grossTotal = totalHourlySalary + totalCashBonus + totalAutoBonus + totalBonuses;
            const totalDeductions = deductionsArray.reduce((sum, d) => sum + d.amount, 0);
            const netTotal = grossTotal - totalDeductions;

            return {
                totalShifts,
                totalHours,
                totalCash,
                totalHourlySalary,
                totalCashBonus,
                totalAutoBonus,
                totalBonuses,
                grossTotal,
                totalDeductions,
                netTotal
            };
        }

        function createChart(canvasId, shiftsArray) {
            setTimeout(() => {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;

                const stats = getStatsByLocation(shiftsArray);
                
                // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö - –Ω–µ —Ä–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫
                if (Object.keys(stats).length === 0) return;
                
                const labels = Object.values(stats).map(s => s.name);
                const data = Object.values(stats).map(s => s.total);

                new Chart(canvas, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –ø–æ —Ç–æ—á–∫–∞–º (‚Ç∏)',
                            data: data,
                            backgroundColor: [
                                'rgba(79, 70, 229, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(245, 158, 11, 0.7)'
                            ],
                            borderColor: [
                                'rgb(79, 70, 229)',
                                'rgb(16, 185, 129)',
                                'rgb(245, 158, 11)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + '‚Ç∏';
                                    }
                                }
                            }
                        }
                    }
                });
            }, 100);
        }

        function createTrendChart(shiftsArray) {
            setTimeout(() => {
                const canvas = document.getElementById('trend-chart');
                if (!canvas) return;
                
                const last7Days = [];
                const today = new Date();
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const dayShifts = shiftsArray.filter(s => s.date === dateStr);
                    const dayEarnings = dayShifts.reduce((sum, s) => 
                        sum + s.hourlySalary + s.cashBonus + (s.autoBonus || 0), 0);
                    
                    last7Days.push({
                        label: new Date(dateStr).toLocaleDateString('ru', { weekday: 'short', day: 'numeric' }),
                        value: dayEarnings
                    });
                }
                
                new Chart(canvas, {
                    type: 'line',
                    data: {
                        labels: last7Days.map(d => d.label),
                        datasets: [{
                            label: '–ó–∞—Ä–∞–±–æ—Ç–æ–∫ (‚Ç∏)',
                            data: last7Days.map(d => d.value),
                            borderColor: 'rgb(79, 70, 229)',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + '‚Ç∏';
                                    }
                                }
                            }
                        }
                    }
                });
            }, 100);
        }

        function createHoursChart(shiftsArray) {
            setTimeout(() => {
                const canvas = document.getElementById('hours-chart');
                if (!canvas) return;
                
                const hoursBuckets = { '<10—á': 0, '10-14—á': 0, '14-18—á': 0, '>18—á': 0 };
                
                shiftsArray.forEach(s => {
                    if (s.hours < 10) hoursBuckets['<10—á']++;
                    else if (s.hours < 14) hoursBuckets['10-14—á']++;
                    else if (s.hours <= 18) hoursBuckets['14-18—á']++;
                    else hoursBuckets['>18—á']++;
                });
                
                new Chart(canvas, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(hoursBuckets),
                        datasets: [{
                            data: Object.values(hoursBuckets),
                            backgroundColor: [
                                'rgba(239, 68, 68, 0.7)',
                                'rgba(245, 158, 11, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(79, 70, 229, 0.7)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }, 100);
        }

        function createTrendChart2(canvasId, shiftsArray) {
            setTimeout(() => {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                
                const last7Days = [];
                const today = new Date();
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const dayShifts = shiftsArray.filter(s => s.date === dateStr);
                    const dayEarnings = dayShifts.reduce((sum, s) => 
                        sum + s.hourlySalary + s.cashBonus + (s.autoBonus || 0), 0);
                    
                    last7Days.push({
                        label: new Date(dateStr).toLocaleDateString('ru', { weekday: 'short', day: 'numeric' }),
                        value: dayEarnings
                    });
                }
                
                new Chart(canvas, {
                    type: 'line',
                    data: {
                        labels: last7Days.map(d => d.label),
                        datasets: [{
                            label: '–ó–∞—Ä–∞–±–æ—Ç–æ–∫ (‚Ç∏)',
                            data: last7Days.map(d => d.value),
                            borderColor: 'rgb(79, 70, 229)',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + '‚Ç∏';
                                    }
                                }
                            }
                        }
                    }
                });
            }, 100);
        }

        function createHoursChart2(canvasId, shiftsArray) {
            setTimeout(() => {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                
                const hoursBuckets = { '<10—á': 0, '10-14—á': 0, '14-18—á': 0, '>18—á': 0 };
                
                shiftsArray.forEach(s => {
                    if (s.hours < 10) hoursBuckets['<10—á']++;
                    else if (s.hours < 14) hoursBuckets['10-14—á']++;
                    else if (s.hours <= 18) hoursBuckets['14-18—á']++;
                    else hoursBuckets['>18—á']++;
                });
                
                new Chart(canvas, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(hoursBuckets),
                        datasets: [{
                            data: Object.values(hoursBuckets),
                            backgroundColor: [
                                'rgba(239, 68, 68, 0.7)',
                                'rgba(245, 158, 11, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(79, 70, 229, 0.7)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }, 100);
        }

        // === RENDER ===
        function renderAuth() {
            document.getElementById('app').innerHTML = `
                <div class="max-w-md mx-auto fade-in">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 hover-lift">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-bold text-gray-800 mb-2">‚òï –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h1>
                            <p class="text-gray-600">–ó–∞—Ä–ø–ª–∞—Ç—ã –±–∞—Ä–∏—Å—Ç</p>
                        </div>

                        <div class="space-y-4 mb-6">
                            <input type="email" id="auth-email" placeholder="Email" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <input type="password" id="auth-password" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <input type="text" id="auth-name" placeholder="–í–∞—à–µ –∏–º—è" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        </div>

                        <div class="space-y-3">
                            <button onclick="window.login()" 
                                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition">
                                üîë –í–æ–π—Ç–∏
                            </button>
                            <button onclick="window.register()" 
                                class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition">
                                ‚ûï –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSettings() {
            document.getElementById('app').innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
                        <button onclick="window.toggleSettings()" 
                            class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold transition">
                            ‚Üê –ù–∞–∑–∞–¥
                        </button>
                    </div>

                    <div class="bg-gray-50 p-6 rounded-xl mb-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">üíµ –ü—Ä–æ—Ü–µ–Ω—Ç —Å –∫–∞—Å—Å—ã</h2>
                        <div class="flex items-center gap-4">
                            <input type="number" step="0.1" value="${userSettings.cashPercent}" 
                                onchange="window.updateCashPercent(this.value)"
                                class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <span class="text-gray-700 font-semibold">%</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –∫–∞—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–π –∏–¥—ë—Ç –≤ –≤–∞—à—É –∑–∞—Ä–ø–ª–∞—Ç—É</p>
                    </div>

                    <div class="bg-gray-50 p-6 rounded-xl mb-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">üí∞ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ–∫–ª–∞–¥—ã</h2>
                        <p class="text-sm text-gray-600 mb-4">–û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–∫–ª–∞–¥</p>
                        
                        <div class="space-y-4">
                            ${Object.entries(LOCATIONS).map(([key, loc]) => {
                                const customWeekday = userSettings.customSalaries[key]?.weekday;
                                const customWeekend = userSettings.customSalaries[key]?.weekend;
                                return `
                                    <div class="bg-white p-4 rounded-lg border border-gray-200">
                                        <div class="font-semibold text-gray-800 mb-3">${loc.name}</div>
                                        
                                        <div class="grid md:grid-cols-2 gap-3">
                                            <div>
                                                <label class="text-xs text-gray-600 block mb-1">–ë—É–¥–Ω–∏ (–ü–Ω-–ß—Ç)</label>
                                                <div class="flex items-center gap-2">
                                                    <input type="number" 
                                                        id="salary-${key}-weekday"
                                                        value="${customWeekday !== null && customWeekday !== undefined ? customWeekday : ''}" 
                                                        placeholder="${loc.weekdaySalary}"
                                                        onchange="window.updateCustomSalary('${key}', 'weekday', this.value)"
                                                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                                                    <span class="text-gray-600 text-sm">‚Ç∏</span>
                                                </div>
                                                <p class="text-xs text-gray-500 mt-1">–°—Ç–∞–Ω–¥–∞—Ä—Ç: ${loc.weekdaySalary.toLocaleString()}‚Ç∏</p>
                                            </div>
                                            
                                            <div>
                                                <label class="text-xs text-gray-600 block mb-1">–í—ã—Ö–æ–¥–Ω—ã–µ (–ü—Ç-–í—Å) üéâ</label>
                                                <div class="flex items-center gap-2">
                                                    <input type="number" 
                                                        id="salary-${key}-weekend"
                                                        value="${customWeekend !== null && customWeekend !== undefined ? customWeekend : ''}" 
                                                        placeholder="${loc.weekendSalary}"
                                                        onchange="window.updateCustomSalary('${key}', 'weekend', this.value)"
                                                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                                                    <span class="text-gray-600 text-sm">‚Ç∏</span>
                                                </div>
                                                <p class="text-xs text-gray-500 mt-1">–°—Ç–∞–Ω–¥–∞—Ä—Ç: ${loc.weekendSalary.toLocaleString()}‚Ç∏</p>
                                            </div>
                                        </div>
                                        
                                        <p class="text-xs text-gray-500 mt-2">–ó–∞ –ø–æ–ª–Ω—É—é —Å–º–µ–Ω—É ${loc.fullHours}—á</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <div class="bg-blue-50 p-6 rounded-xl mb-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">üìç –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –ª–æ–∫–∞—Ü–∏–π</h2>
                        <p class="text-sm text-blue-700 mb-4">–≠—Ç–∏ —Å—Ç–∞–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –æ–∫–ª–∞–¥</p>
                        <div class="space-y-3">
                            ${Object.entries(LOCATIONS).map(([key, loc]) => `
                                <div class="bg-white p-4 rounded-lg border border-gray-200">
                                    <div class="font-semibold text-gray-800">${loc.name}</div>
                                    <div class="text-sm text-gray-600">–ë—É–¥–Ω–∏ (–ü–Ω-–ß—Ç): ${loc.fullHours}—á = ${loc.weekdaySalary.toLocaleString()}‚Ç∏ (${(loc.weekdaySalary / loc.fullHours).toFixed(2)}‚Ç∏/—á)</div>
                                    <div class="text-sm text-gray-600">–í—ã—Ö–æ–¥–Ω—ã–µ (–ü—Ç-–í—Å): ${loc.fullHours}—á = ${loc.weekendSalary.toLocaleString()}‚Ç∏ (${(loc.weekendSalary / loc.fullHours).toFixed(2)}‚Ç∏/—á)</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg mb-6">
                        <p class="text-sm text-yellow-800">
                            <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
                            ‚Ä¢ –ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –Ω–æ–≤—ã–º —Å–º–µ–Ω–∞–º<br>
                            ‚Ä¢ –°—Ç–∞—Ä—ã–µ —Å–º–µ–Ω—ã –æ—Å—Ç–∞—é—Ç—Å—è —Å —Ç–µ–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã<br>
                            ‚Ä¢ –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–∫–ª–∞–¥<br>
                            ‚Ä¢ –í—ã—Ö–æ–¥–Ω—ã–µ: –ü—è—Ç–Ω–∏—Ü–∞, –°—É–±–±–æ—Ç–∞, –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ üéâ
                        </p>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="window.saveUserSettings()" 
                            class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-lg transition text-lg">
                            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        </button>
                        <button onclick="window.toggleSettings()" 
                            class="px-6 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-4 rounded-lg transition">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            `;
        }

        function renderManagerView() {
            if (editingBaristaId && editingBaristaSettings) {
                const barista = allBaristas.find(b => b.id === editingBaristaId);
                document.getElementById('app').innerHTML = `
                    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-3xl font-bold text-gray-800">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏: ${barista.name}</h1>
                            <button onclick="window.closeBaristaSettings()" 
                                class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold transition">
                                ‚Üê –ù–∞–∑–∞–¥
                            </button>
                        </div>

                        <div class="space-y-6">
                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h2 class="text-xl font-bold text-gray-800 mb-4">üíµ –ü—Ä–æ—Ü–µ–Ω—Ç —Å –∫–∞—Å—Å—ã</h2>
                                <div class="flex items-center gap-4">
                                    <input type="number" step="0.1" value="${editingBaristaSettings.cashPercent}" 
                                        onchange="window.updateBaristaSettings('cashPercent', this.value)"
                                        class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    <span class="text-gray-700 font-semibold">%</span>
                                </div>
                            </div>

                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h2 class="text-xl font-bold text-gray-800 mb-4">üë§ –ò–º—è –±–∞—Ä–∏—Å—Ç–∞</h2>
                                <input type="text" 
                                    value="${barista.name}" 
                                    onchange="window.updateBaristaName(this.value)"
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <p class="text-sm text-gray-600 mt-2">–≠—Ç–æ –∏–º—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–æ –≤—Å–µ—Ö –æ—Ç—á–µ—Ç–∞—Ö</p>
                            </div>

                            <div class="bg-gray-50 p-6 rounded-xl">
                                <h2 class="text-xl font-bold text-gray-800 mb-4">üí∞ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ–∫–ª–∞–¥—ã</h2>
                                <p class="text-sm text-gray-600 mb-4">–û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–∫–ª–∞–¥</p>
                                
                                <div class="space-y-4">
                                    ${Object.entries(LOCATIONS).map(([key, loc]) => {
                                        const customWeekday = editingBaristaSettings.customSalaries[key]?.weekday;
                                        const customWeekend = editingBaristaSettings.customSalaries[key]?.weekend;
                                        return `
                                            <div class="bg-white p-4 rounded-lg border border-gray-200">
                                                <div class="font-semibold text-gray-800 mb-3">${loc.name}</div>
                                                
                                                <div class="grid md:grid-cols-2 gap-3">
                                                    <div>
                                                        <label class="text-xs text-gray-600 block mb-1">–ë—É–¥–Ω–∏ (–ü–Ω-–ß—Ç)</label>
                                                        <div class="flex items-center gap-2">
                                                            <input type="number" 
                                                                value="${customWeekday !== null && customWeekday !== undefined ? customWeekday : ''}" 
                                                                placeholder="${loc.weekdaySalary}"
                                                                onchange="window.updateBaristaSettings('${key}', 'weekday', this.value)"
                                                                class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                                                            <span class="text-gray-600 text-sm">‚Ç∏</span>
                                                        </div>
                                                        <p class="text-xs text-gray-500 mt-1">–°—Ç–∞–Ω–¥–∞—Ä—Ç: ${loc.weekdaySalary.toLocaleString()}‚Ç∏</p>
                                                    </div>
                                                    
                                                    <div>
                                                        <label class="text-xs text-gray-600 block mb-1">–í—ã—Ö–æ–¥–Ω—ã–µ (–ü—Ç-–í—Å) üéâ</label>
                                                        <div class="flex items-center gap-2">
                                                            <input type="number" 
                                                                value="${customWeekend !== null && customWeekend !== undefined ? customWeekend : ''}" 
                                                                placeholder="${loc.weekendSalary}"
                                                                onchange="window.updateBaristaSettings('${key}', 'weekend', this.value)"
                                                                class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
                                                            <span class="text-gray-600 text-sm">‚Ç∏</span>
                                                        </div>
                                                        <p class="text-xs text-gray-500 mt-1">–°—Ç–∞–Ω–¥–∞—Ä—Ç: ${loc.weekendSalary.toLocaleString()}‚Ç∏</p>
                                                    </div>
                                                </div>
                                                
                                                <p class="text-xs text-gray-500 mt-2">–ó–∞ –ø–æ–ª–Ω—É—é —Å–º–µ–Ω—É ${loc.fullHours}—á</p>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>

                            <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg">
                                <p class="text-sm text-blue-800">
                                    <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
                                    ‚Ä¢ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–∫–ª–∞–¥—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π<br>
                                    ‚Ä¢ –ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –Ω–æ–≤—ã–º —Å–º–µ–Ω–∞–º<br>
                                    ‚Ä¢ –°—Ç–∞—Ä—ã–µ —Å–º–µ–Ω—ã –æ—Å—Ç–∞—é—Ç—Å—è —Å —Ç–µ–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
                                </p>
                            </div>

                            <div class="flex gap-4">
                                <button onclick="window.saveBaristaSettings()" 
                                    class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-lg transition text-lg">
                                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                                </button>
                                <button onclick="window.closeBaristaSettings()" 
                                    class="px-6 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-4 rounded-lg transition">
                                    –û—Ç–º–µ–Ω–∞
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            const baristaShifts = selectedBaristaId === 'all' 
                ? shifts 
                : filterShiftsByBarista(shifts, selectedBaristaId);

            const baristaDeductions = selectedBaristaId === 'all'
                ? deductions
                : deductions.filter(d => d.userId === selectedBaristaId);

            const baristaBonuses = selectedBaristaId === 'all'
                ? bonuses
                : bonuses.filter(b => b.userId === selectedBaristaId);

            const availableMonths = getAvailableMonths(baristaShifts);
            const monthShifts = filterShiftsByMonth(baristaShifts, selectedMonth);
            const locationShifts = selectedLocation === 'all' ? monthShifts : monthShifts.filter(s => s.locationKey === selectedLocation);
            const monthDeductions = filterDeductionsByMonth(baristaDeductions, selectedMonth);
            const monthBonuses = filterBonusesByMonth(baristaBonuses, selectedMonth);

            const groupedByBarista = {};
            locationShifts.forEach(shift => {
                if (!groupedByBarista[shift.userId]) {
                    groupedByBarista[shift.userId] = {
                        name: shift.userName,
                        shifts: [],
                        deductions: [],
                        bonuses: []
                    };
                }
                groupedByBarista[shift.userId].shifts.push(shift);
            });

            monthDeductions.forEach(deduction => {
                if (groupedByBarista[deduction.userId]) {
                    groupedByBarista[deduction.userId].deductions.push(deduction);
                }
            });

            monthBonuses.forEach(bonus => {
                if (groupedByBarista[bonus.userId]) {
                    groupedByBarista[bonus.userId].bonuses.push(bonus);
                }
            });

            document.getElementById('app').innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 fade-in">
                    <div class="flex justify-between items-center flex-wrap gap-4">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">üëî –ü–∞–Ω–µ–ª—å –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞</h1>
                            <p class="text-gray-600">${userProfile.name} (${currentUser.email})</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="window.toggleDarkMode()" 
                                class="px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-lg font-semibold transition">
                                ${darkMode ? '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è' : 'üåô –¢—ë–º–Ω–∞—è'}
                            </button>
                            <button onclick="window.logout()" 
                                class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition">
                                üö™ –í—ã—Ö–æ–¥
                            </button>
                        </div>
                    </div>
                </div>

                ${allBaristas.length > 0 ? `
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in hover-lift">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">üë• –í—ã–±–µ—Ä–∏—Ç–µ –±–∞—Ä–∏—Å—Ç–∞</h2>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="window.changeBarista('all')" 
                            class="px-4 py-2 rounded-lg font-semibold transition ${selectedBaristaId === 'all' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                            –í—Å–µ –±–∞—Ä–∏—Å—Ç–∞
                        </button>
                        ${allBaristas.map(barista => `
                            <div class="flex gap-1">
                                <button onclick="window.changeBarista('${barista.id}')"
                                    class="px-4 py-2 rounded-lg font-semibold transition ${selectedBaristaId === barista.id ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                                    ‚òï ${barista.name}
                                </button>
                                <button onclick="window.openBaristaSettings('${barista.id}')" 
                                    class="px-3 py-2 rounded-lg bg-gray-300 hover:bg-gray-400 transition" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                                    ‚öôÔ∏è
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : '<div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg mb-6"><p class="text-yellow-800">–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∞—Ä–∏—Å—Ç–æ–≤</p></div>'}

                <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in hover-lift">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">üìç –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É</h2>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="window.changeLocation('all')" 
                            class="px-4 py-2 rounded-lg font-semibold transition ${selectedLocation === 'all' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                            –í—Å–µ —Ç–æ—á–∫–∏
                        </button>
                        ${Object.entries(LOCATIONS).map(([key, loc]) => `
                            <button onclick="window.changeLocation('${key}')" 
                                class="px-4 py-2 rounded-lg font-semibold transition ${selectedLocation === key ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                                üìç ${loc.name}
                            </button>
                        `).join('')}
                    </div>
                </div>

                ${availableMonths.length > 0 ? `
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in hover-lift">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥</h2>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="window.changeMonth('all')" 
                            class="px-4 py-2 rounded-lg font-semibold transition ${selectedMonth === 'all' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                            –í—Å–µ –≤—Ä–µ–º—è
                        </button>
                        ${availableMonths.map(month => `
                            <button onclick="window.changeMonth('${month}')" 
                                class="px-4 py-2 rounded-lg font-semibold transition ${selectedMonth === month ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                                ${getMonthName(month)}
                            </button>
                        `).join('')}
                    </div>
                </div>
                ` : ''}

                ${Object.keys(groupedByBarista).length > 0 ? `
                <div class="space-y-6">
                    ${Object.entries(groupedByBarista).map(([userId, data]) => {
                        const totals = getTotals(data.shifts, data.deductions, data.bonuses);

                        return `
                            <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in hover-lift">
                                <h2 class="text-2xl font-bold text-gray-800 mb-4">‚òï ${data.name}</h2>
                                
                                <!-- ========== 5 –û–°–ù–û–í–ù–´–• –ö–ê–†–¢–û–ß–ï–ö (–Ω–µ —Ç—Ä–æ–≥–∞–µ–º) ========== -->
                                <div class="grid md:grid-cols-5 gap-4 mb-6">
                                    <div class="bg-blue-50 rounded-lg p-4">
                                        <div class="text-sm text-blue-600 mb-1">–°–º–µ–Ω</div>
                                        <div class="text-2xl font-bold text-blue-900">${totals.totalShifts}</div>
                                    </div>
                                    <div class="bg-purple-50 rounded-lg p-4">
                                        <div class="text-sm text-purple-600 mb-1">–ß–∞—Å–æ–≤</div>
                                        <div class="text-2xl font-bold text-purple-900">${totals.totalHours.toFixed(1)}—á</div>
                                    </div>
                                    <div class="bg-green-50 rounded-lg p-4">
                                        <div class="text-sm text-green-600 mb-1">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                                        <div class="text-2xl font-bold text-green-900">${totals.grossTotal.toFixed(0).toLocaleString()}‚Ç∏</div>
                                        ${totals.totalAutoBonus > 0 ? `<div class="text-xs text-green-700 mt-1">üéÅ –ë–æ–Ω—É—Å—ã: ${totals.totalAutoBonus.toLocaleString()}‚Ç∏</div>` : ''}
                                    </div>
                                    <div class="bg-red-50 rounded-lg p-4">
                                        <div class="text-sm text-red-600 mb-1">–í—ã—á–µ—Ç—ã</div>
                                        <div class="text-2xl font-bold text-red-900">-${totals.totalDeductions.toLocaleString()}‚Ç∏</div>
                                    </div>
                                    <div class="bg-indigo-50 rounded-lg p-4">
                                        <div class="text-sm text-indigo-600 mb-1">–ö –≤—ã–ø–ª–∞—Ç–µ</div>
                                        <div class="text-2xl font-bold text-indigo-900">${totals.netTotal.toFixed(0).toLocaleString()}‚Ç∏</div>
                                    </div>
                                </div>
                                <!-- ========== –ö–û–ù–ï–¶ 5 –û–°–ù–û–í–ù–´–• –ö–ê–†–¢–û–ß–ï–ö ========== -->

                                <!-- ========== üÜï –ù–û–í–´–ï 4 –ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–ï –ö–ê–†–¢–û–ß–ö–ò ========== -->
                                ${data.shifts.length > 0 ? `
                                <div class="grid lg:grid-cols-4 gap-4 mb-6">
                                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                                        <div class="text-sm opacity-90 mb-2">üìÖ –°–º–µ–Ω –≤ –º–µ—Å—è—Ü</div>
                                        <div class="text-3xl font-bold">${totals.totalShifts}</div>
                                        <div class="text-xs opacity-75 mt-1">~${(totals.totalShifts / 30 * 7).toFixed(1)} –≤ –Ω–µ–¥–µ–ª—é</div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                                        <div class="text-sm opacity-90 mb-2">üí∞ –°—Ä–µ–¥–Ω–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫</div>
                                        <div class="text-3xl font-bold">${(totals.grossTotal / totals.totalShifts || 0).toFixed(0).toLocaleString()}‚Ç∏</div>
                                        <div class="text-xs opacity-75 mt-1">–∑–∞ —Å–º–µ–Ω—É</div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                                        <div class="text-sm opacity-90 mb-2">‚è∞ –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                                        <div class="text-3xl font-bold">${(totals.totalHours / totals.totalShifts || 0).toFixed(1)}—á</div>
                                        <div class="text-xs opacity-75 mt-1">—á–∞—Å–æ–≤ –∑–∞ —Å–º–µ–Ω—É</div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl shadow-lg p-6 text-white">
                                        <div class="text-sm opacity-90 mb-2">üìà –ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞</div>
                                        <div class="text-3xl font-bold">${(totals.grossTotal / totals.totalHours || 0).toFixed(0)}‚Ç∏</div>
                                        <div class="text-xs opacity-75 mt-1">—Ç–µ–Ω–≥–µ –≤ —á–∞—Å</div>
                                    </div>
                                </div>
                                ` : ''}
                                <!-- ========== –ö–û–ù–ï–¶ 4 –ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–• –ö–ê–†–¢–û–ß–ï–ö ========== -->

                                <!-- ========== üÜï –ì–†–ê–§–ò–ö –ó–ê–†–ê–ë–û–¢–ö–ê –ü–û –¢–û–ß–ö–ê–ú ========== -->
                                ${data.shifts.length > 0 && selectedLocation === 'all' ? `
                                <div class="mb-6">
                                    <h3 class="text-lg font-bold text-gray-800 mb-3">üìä –î–∏–∞–≥—Ä–∞–º–º–∞ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —Ç–æ—á–∫–∞–º</h3>
                                    <div class="h-64">
                                        <canvas id="chart-${userId}"></canvas>
                                    </div>
                                </div>
                                ` : ''}
                                <!-- ========== –ö–û–ù–ï–¶ –ì–†–ê–§–ò–ö–ê –ü–û –¢–û–ß–ö–ê–ú ========== -->

                                <!-- ========== üÜï –î–í–ê –ù–û–í–´–• –ì–†–ê–§–ò–ö–ê ========== -->
                                ${data.shifts.length > 0 ? `
                                <div class="grid lg:grid-cols-2 gap-6 mb-6">
                                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                                        <h3 class="text-lg font-bold text-gray-800 mb-3">üìà –î–∏–Ω–∞–º–∏–∫–∞ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</h3>
                                        <div class="h-64">
                                            <canvas id="trend-chart-${userId}"></canvas>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                                        <h3 class="text-lg font-bold text-gray-800 mb-3">‚è∞ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —á–∞—Å–∞–º</h3>
                                        <div class="h-64">
                                            <canvas id="hours-chart-${userId}"></canvas>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}

                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-3 py-2 text-left font-semibold text-gray-700">–î–∞—Ç–∞</th>
                                                <th class="px-3 py-2 text-left font-semibold text-gray-700">–¢–æ—á–∫–∞</th>
                                                <th class="px-3 py-2 text-right font-semibold text-gray-700">–í—Ä–µ–º—è</th>
                                                <th class="px-3 py-2 text-right font-semibold text-gray-700">–ß–∞—Å—ã</th>
                                                <th class="px-3 py-2 text-right font-semibold text-gray-700">–ö–∞—Å—Å–∞</th>
                                                <th class="px-3 py-2 text-right font-semibold text-gray-700">–ó–ü (–æ–∫–ª–∞–¥)</th>
                                                <th class="px-3 py-2 text-right font-semibold text-gray-700">–ó–ü (–ø—Ä–æ—Ü–µ–Ω—Ç)</th>
                                                <th class="px-3 py-2 text-right font-semibold text-gray-700">–ó–ü</th>
                                                <th class="px-3 py-2 text-center font-semibold text-gray-700">–î–µ–π—Å—Ç–≤–∏—è</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200">
                                            ${data.shifts.map(shift => `
                                                <tr class="hover:bg-gray-50">
                                                    <td class="px-3 py-2 text-gray-700">
                                                        ${shift.date}
                                                        ${shift.isWeekend ? '<span class="text-xs text-orange-600 ml-1">üéâ</span>' : ''}
                                                    </td>
                                                    <td class="px-3 py-2 text-gray-700">${shift.locationName}</td>
                                                    <td class="px-3 py-2 text-right text-gray-700">${shift.startTime}-${shift.endTime}</td>
                                                    <td class="px-3 py-2 text-right text-gray-700">${shift.hours.toFixed(1)}—á</td>
                                                    <td class="px-3 py-2 text-right text-gray-700">${shift.cash.toLocaleString()}‚Ç∏</td>
                                                    <td class="px-3 py-2 text-right text-blue-600 font-semibold">
                                                        ${shift.hourlySalary.toFixed(0).toLocaleString()}‚Ç∏
                                                    </td>
                                                    <td class="px-3 py-2 text-right text-green-600 font-semibold">
                                                        ${shift.cashBonus.toFixed(0).toLocaleString()}‚Ç∏
                                                    </td>
                                                    <td class="px-3 py-2 text-right text-indigo-600 font-bold">
                                                        ${(shift.hourlySalary + shift.cashBonus + (shift.autoBonus || 0)).toFixed(0).toLocaleString()}‚Ç∏
                                                    </td>
                                                    <td class="px-3 py-2 text-center">
                                                        <button onclick="window.deleteShift('${shift.id}')" 
                                                            class="text-red-600 hover:text-red-800 text-xl" title="–£–¥–∞–ª–∏—Ç—å —Å–º–µ–Ω—É">üóëÔ∏è</button>
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>

                                <div class="grid md:grid-cols-2 gap-4 mt-4">
                                    ${data.bonuses.length > 0 ? `
                                    <div>
                                        <h3 class="font-bold text-gray-800 mb-2">üéÅ –ü—Ä–µ–º–∏–∏:</h3>
                                        <div class="space-y-1">
                                            ${data.bonuses.map(b => `
                                                <div class="flex justify-between items-center bg-green-50 px-3 py-2 rounded">
                                                    <div>
                                                        <span class="text-gray-700">${b.name}</span>
                                                        <span class="text-green-600 font-semibold ml-2">+${b.amount.toLocaleString()}‚Ç∏</span>
                                                    </div>
                                                    <button onclick="window.deleteBonus('${b.id}')" 
                                                        class="text-red-600 hover:text-red-800 text-lg" title="–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–º–∏—é">üóëÔ∏è</button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    ` : ''}
                                    
                                    ${data.deductions.length > 0 ? `
                                    <div>
                                        <h3 class="font-bold text-gray-800 mb-2">üí∏ –í—ã—á–µ—Ç—ã:</h3>
                                        <div class="space-y-1">
                                            ${data.deductions.map(d => `
                                                <div class="flex justify-between items-center bg-red-50 px-3 py-2 rounded">
                                                    <div>
                                                        <span class="text-gray-700">${d.name}</span>
                                                        <span class="text-red-600 font-semibold ml-2">-${d.amount.toLocaleString()}‚Ç∏</span>
                                                    </div>
                                                    <button onclick="window.deleteDeduction('${d.id}')" 
                                                        class="text-red-600 hover:text-red-800 text-lg" title="–£–¥–∞–ª–∏—Ç—å –≤—ã—á–µ—Ç">üóëÔ∏è</button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                ` : '<div class="bg-gray-50 border border-gray-200 p-8 rounded-lg text-center"><p class="text-gray-600 text-lg">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p></div>'}
            `;

            // –°–û–ó–î–ê–Å–ú –ì–†–ê–§–ò–ö–ò –î–õ–Ø –ö–ê–ñ–î–û–ì–û –ë–ê–†–ò–°–¢–ê
            if (Object.keys(groupedByBarista).length > 0) {
                Object.entries(groupedByBarista).forEach(([userId, data]) => {
                    if (data.shifts.length > 0) {
                        if (selectedLocation === 'all') {
                            createChart(`chart-${userId}`, data.shifts);
                        }
                        createTrendChart2(`trend-chart-${userId}`, data.shifts);
                        createHoursChart2(`hours-chart-${userId}`, data.shifts);
                    }
                });
            }
        }

        function renderBaristaView() {
            const availableMonths = getAvailableMonths(shifts);
            const monthShifts = filterShiftsByMonth(shifts, selectedMonth);
            const monthDeductions = filterDeductionsByMonth(deductions, selectedMonth);
            const monthBonuses = filterBonusesByMonth(bonuses, selectedMonth);
            const stats = getStatsByLocation(monthShifts);
            const totals = getTotals(monthShifts, monthDeductions, monthBonuses);
            const today = new Date().toISOString().split('T')[0];

            document.getElementById('app').innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                    <div class="flex justify-between items-center flex-wrap gap-4">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">üí∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞—Ä–ø–ª–∞—Ç—ã</h1>
                            <p class="text-gray-600">‚òï –ë–∞—Ä–∏—Å—Ç–∞: ${userProfile.name} (${currentUser.email})</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="window.toggleDarkMode()" 
                                class="px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-lg font-semibold transition">
                                ${darkMode ? '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è' : 'üåô –¢—ë–º–Ω–∞—è'}
                            </button>
                            <button onclick="window.toggleSettings()" 
                                class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-semibold transition">
                                ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                            <button onclick="window.logout()" 
                                class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition">
                                üö™ –í—ã—Ö–æ–¥
                            </button>
                        </div>
                    </div>
                </div>

                ${availableMonths.length > 0 ? `
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in hover-lift">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥</h2>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="window.changeMonth('all')" 
                            class="px-4 py-2 rounded-lg font-semibold transition ${selectedMonth === 'all' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                            –í—Å–µ –≤—Ä–µ–º—è
                        </button>
                        ${availableMonths.map(month => `
                            <button onclick="window.changeMonth('${month}')" 
                                class="px-4 py-2 rounded-lg font-semibold transition ${selectedMonth === month ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                                ${getMonthName(month)}
                            </button>
                        `).join('')}
                    </div>
                </div>
                ` : ''}

                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl shadow-lg p-6 text-white mb-6">
                    <h2 class="text-2xl font-bold mb-4">üìä ${getMonthName(selectedMonth)}</h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <div class="text-sm opacity-90 mb-1">–°–º–µ–Ω</div>
                            <div class="text-3xl font-bold">${totals.totalShifts}</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <div class="text-sm opacity-90 mb-1">–ß–∞—Å–æ–≤</div>
                            <div class="text-3xl font-bold">${totals.totalHours.toFixed(1)}—á</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <div class="text-sm opacity-90 mb-1">–ö–∞—Å—Å–∞</div>
                            <div class="text-2xl font-bold">${totals.totalCash.toLocaleString()}‚Ç∏</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <div class="text-sm opacity-90 mb-1">–ó–ü —Å –æ–∫–ª–∞–¥–∞</div>
                            <div class="text-2xl font-bold">${totals.totalHourlySalary.toFixed(0).toLocaleString()}‚Ç∏</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <div class="text-sm opacity-90 mb-1">–ó–ü —Å –∫–∞—Å—Å—ã (${userSettings.cashPercent}%)</div>
                            <div class="text-2xl font-bold">${totals.totalCashBonus.toFixed(0).toLocaleString()}‚Ç∏</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <div class="text-sm opacity-90 mb-1">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                            <div class="text-2xl font-bold">${totals.grossTotal.toFixed(0).toLocaleString()}‚Ç∏</div>
                            ${totals.totalAutoBonus > 0 ? `<div class="text-xs opacity-80 mt-1">üéÅ –ë–æ–Ω—É—Å—ã: ${totals.totalAutoBonus.toLocaleString()}‚Ç∏</div>` : ''}
                            ${totals.totalBonuses > 0 ? `<div class="text-xs opacity-80 mt-1">üéÅ –ü—Ä–µ–º–∏–∏: ${totals.totalBonuses.toLocaleString()}‚Ç∏</div>` : ''}
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <div class="text-sm opacity-90 mb-1">–í—ã—á–µ—Ç—ã</div>
                            <div class="text-2xl font-bold text-red-300">-${totals.totalDeductions.toLocaleString()}‚Ç∏</div>
                        </div>
                        <div class="bg-white bg-opacity-30 rounded-lg p-4 border-2 border-white">
                            <div class="text-sm opacity-90 mb-1">–ö –ü–û–õ–£–ß–ï–ù–ò–Æ</div>
                            <div class="text-3xl font-bold">${totals.netTotal.toFixed(0).toLocaleString()}‚Ç∏</div>
                        </div>
                    </div>
                </div>

                ${monthShifts.length > 0 ? `
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in hover-lift">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">üìä –î–∏–∞–≥—Ä–∞–º–º–∞ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —Ç–æ—á–∫–∞–º</h2>
                    <div class="h-64">
                        <canvas id="earnings-chart"></canvas>
                    </div>
                </div>
                ` : ''}
                ${monthShifts.length > 0 ? `
                <div class="grid lg:grid-cols-2 gap-6 mb-6 fade-in">
                    <div class="bg-white rounded-xl shadow-lg p-6 hover-lift">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">üìà –î–∏–Ω–∞–º–∏–∫–∞ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</h2>
                        <div class="h-64">
                            <canvas id="trend-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6 hover-lift">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">‚è∞ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —á–∞—Å–∞–º</h2>
                        <div class="h-64">
                            <canvas id="hours-chart"></canvas>
                        </div>
                    </div>
                </div>
                ` : ''}

                ${Object.keys(stats).length > 0 ? `
                <div class="grid lg:grid-cols-3 gap-6 mb-6">
                    ${Object.entries(stats).map(([key, stat]) => {
                        const colors = {
                            boxpark: 'from-indigo-500 to-indigo-600',
                            aport: 'from-green-500 to-green-600',
                            saryarka: 'from-amber-500 to-amber-600'
                        };
                        return `
                            <div class="bg-gradient-to-br ${colors[key] || 'from-gray-500 to-gray-600'} rounded-xl shadow-lg p-6 text-white">
                                <h3 class="text-xl font-bold mb-4">üìç ${stat.name}</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="opacity-90">–°–º–µ–Ω:</span>
                                        <span class="font-bold">${stat.shifts}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="opacity-90">–ß–∞—Å–æ–≤:</span>
                                        <span class="font-bold">${stat.hours.toFixed(1)}—á</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="opacity-90">–ö–∞—Å—Å–∞:</span>
                                        <span class="font-bold">${stat.cash.toLocaleString()}‚Ç∏</span>
                                    </div>
                                    <div class="flex justify-between border-t border-white border-opacity-30 pt-2 mt-2">
                                        <span class="opacity-90">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</span>
                                        <span class="font-bold text-lg">${stat.total.toFixed(0).toLocaleString()}‚Ç∏</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                ` : ''}

                <div class="grid lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in hover-lift">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ –î–∞—Ç–∞</label>
                                <input type="date" id="shift-date" value="${today}" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">üìç –¢–æ—á–∫–∞</label>
                                <select id="shift-location" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                    ${Object.entries(LOCATIONS).map(([key, loc]) => 
                                        `<option value="${key}">${loc.name} (${loc.fullHours}—á = ${loc.weekdaySalary}‚Ç∏)</option>`
                                    ).join('')}
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">üïê –ù–∞—á–∞–ª–æ</label>
                                <input type="time" id="shift-start" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <input type="range" min="0" max="1439" step="30" value="420"
                                    oninput="window.updateTimeFromSlider('shift-start', this.value)"
                                    class="w-full mt-2">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">üïê –ö–æ–Ω–µ—Ü</label>
                                <input type="time" id="shift-end" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <input type="range" min="0" max="1439" step="30" value="1020"
                                    oninput="window.updateTimeFromSlider('shift-end', this.value)"
                                    class="w-full mt-2">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">üíµ –ö–∞—Å—Å–∞ (‚Ç∏)</label>
                                <input type="number" id="shift-cash" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 50000" 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            </div>

                            <button onclick="window.addShift()" 
                                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg transition">
                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω—É
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in hover-lift">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">üéÅ –ü—Ä–µ–º–∏–∏</h2>
                        
                        <div class="space-y-4 mb-4">
                            <input type="text" id="bonus-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–ø—Ä–µ–º–∏—è, –±–æ–Ω—É—Å)" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <input type="number" id="bonus-amount" placeholder="–°—É–º–º–∞ (‚Ç∏)" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <button onclick="window.addBonus()" 
                                class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg transition">
                                –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–º–∏—é
                            </button>
                        </div>

                        ${monthBonuses.length > 0 ? `
                        <div class="space-y-2 max-h-64 overflow-y-auto">
                            ${monthBonuses.map(b => `
                                <div class="flex justify-between items-center bg-green-50 p-3 rounded-lg">
                                    <div>
                                        <div class="font-semibold text-gray-800">${b.name}</div>
                                        <div class="text-green-600">+${b.amount.toLocaleString()}‚Ç∏</div>
                                    </div>
                                    <button onclick="window.deleteBonus('${b.id}')" 
                                        class="text-red-600 hover:text-red-800 text-xl">üóëÔ∏è</button>
                                </div>
                            `).join('')}
                        </div>
                        ` : '<p class="text-gray-500 text-center py-4">–ü—Ä–µ–º–∏–π –Ω–µ—Ç</p>'}
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in hover-lift">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">üí∏ –í—ã—á–µ—Ç—ã</h2>
                        
                        <div class="space-y-4 mb-4">
                            <input type="text" id="deduction-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (—à—Ç—Ä–∞—Ñ, –∞–≤–∞–Ω—Å)" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <input type="number" id="deduction-amount" placeholder="–°—É–º–º–∞ (‚Ç∏)" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <button onclick="window.addDeduction()" 
                                class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition">
                                –î–æ–±–∞–≤–∏—Ç—å –≤—ã—á–µ—Ç
                            </button>
                        </div>

                        ${monthDeductions.length > 0 ? `
                        <div class="space-y-2 max-h-64 overflow-y-auto">
                            ${monthDeductions.map(d => `
                                <div class="flex justify-between items-center bg-red-50 p-3 rounded-lg">
                                    <div>
                                        <div class="font-semibold text-gray-800">${d.name}</div>
                                        <div class="text-red-600">-${d.amount.toLocaleString()}‚Ç∏</div>
                                    </div>
                                    <button onclick="window.deleteDeduction('${d.id}')" 
                                        class="text-red-600 hover:text-red-800 text-xl">üóëÔ∏è</button>
                                </div>
                            `).join('')}
                        </div>
                        ` : '<p class="text-gray-500 text-center py-4">–í—ã—á–µ—Ç–æ–≤ –Ω–µ—Ç</p>'}
                    </div>
                </div>
                
                ${monthShifts.length > 0 ? `
                <div class="grid lg:grid-cols-4 gap-4 mb-6 fade-in">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white hover-lift">
                        <div class="text-sm opacity-90 mb-2">üìÖ –°–º–µ–Ω –≤ –º–µ—Å—è—Ü</div>
                        <div class="text-3xl font-bold">${totals.totalShifts}</div>
                        <div class="text-xs opacity-75 mt-1">~${(totals.totalShifts / 30 * 7).toFixed(1)} –≤ –Ω–µ–¥–µ–ª—é</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white hover-lift">
                        <div class="text-sm opacity-90 mb-2">üí∞ –°—Ä–µ–¥–Ω–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫</div>
                        <div class="text-3xl font-bold">${(totals.grossTotal / totals.totalShifts || 0).toFixed(0).toLocaleString()}‚Ç∏</div>
                        <div class="text-xs opacity-75 mt-1">–∑–∞ —Å–º–µ–Ω—É</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white hover-lift">
                        <div class="text-sm opacity-90 mb-2">‚è∞ –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                        <div class="text-3xl font-bold">${(totals.totalHours / totals.totalShifts || 0).toFixed(1)}—á</div>
                        <div class="text-xs opacity-75 mt-1">—á–∞—Å–æ–≤ –∑–∞ —Å–º–µ–Ω—É</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl shadow-lg p-6 text-white hover-lift">
                        <div class="text-sm opacity-90 mb-2">üìà –ü–æ—á–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞</div>
                        <div class="text-3xl font-bold">${(totals.grossTotal / totals.totalHours || 0).toFixed(0)}‚Ç∏</div>
                        <div class="text-xs opacity-75 mt-1">—Ç–µ–Ω–≥–µ –≤ —á–∞—Å</div>
                    </div>
                </div>
                ` : ''}

                ${monthShifts.length > 0 ? `
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in hover-lift">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">üìù –ò—Å—Ç–æ—Ä–∏—è —Å–º–µ–Ω</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700">–î–∞—Ç–∞</th>
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700">–¢–æ—á–∫–∞</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">–í—Ä–µ–º—è</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">–ß–∞—Å—ã</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">–ö–∞—Å—Å–∞</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">–ó–ü (–æ–∫–ª–∞–¥)</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">–ó–ü (–ø—Ä–æ—Ü–µ–Ω—Ç)</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">–ó–ü</th>
                                    <th class="px-4 py-3 text-center font-semibold text-gray-700">–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${monthShifts.map(shift => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-4 py-3 text-gray-700">
                                            ${shift.date}
                                            ${shift.isWeekend ? '<span class="text-xs text-orange-600 ml-1">üéâ</span>' : ''}
                                        </td>
                                        <td class="px-4 py-3 text-gray-700">${shift.locationName}</td>
                                        <td class="px-4 py-3 text-right text-gray-700">${shift.startTime}-${shift.endTime}</td>
                                        <td class="px-4 py-3 text-right text-gray-700">${shift.hours.toFixed(1)}—á</td>
                                        <td class="px-4 py-3 text-right text-gray-700">${shift.cash.toLocaleString()}‚Ç∏</td>
                                        <td class="px-4 py-3 text-right text-blue-600 font-semibold">
                                            ${shift.hourlySalary.toFixed(0).toLocaleString()}‚Ç∏
                                        </td>
                                        <td class="px-4 py-3 text-right text-green-600 font-semibold">
                                            ${shift.cashBonus.toFixed(0).toLocaleString()}‚Ç∏
                                        </td>
                                        <td class="px-4 py-3 text-right text-indigo-600 font-bold">
                                            ${(shift.hourlySalary + shift.cashBonus + (shift.autoBonus || 0)).toFixed(0).toLocaleString()}‚Ç∏
                                            ${(shift.autoBonus || 0) > 0 ? `<div class="text-xs text-green-600">üéÅ +${shift.autoBonus}‚Ç∏</div>` : ''}
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <button onclick="window.deleteShift('${shift.id}')" 
                                                class="text-red-600 hover:text-red-800 text-xl">üóëÔ∏è</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                ` : '<div class="bg-gray-50 border border-gray-200 p-8 rounded-lg text-center"><p class="text-gray-600 text-lg">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p></div>'}
            `;

            if (monthShifts.length > 0) {
                createChart('earnings-chart', monthShifts);
                createTrendChart(monthShifts);
                createHoursChart(monthShifts);
            }
        }


        function render() {
            if (!currentUser) {
                renderAuth();
            } else if (showSettings) {
                renderSettings();
            } else if (userProfile?.role === 'manager') {
                renderManagerView();
            } else {
                renderBaristaView();
            }
        }

        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            if (user) {
                await loadUserProfile();
                await loadUserSettings();
                await loadData();
            } else {
                render();
            }
        });
        applyDarkMode();
        
        const isDev = location.hostname === 'localhost' || 
                      location.hostname === '127.0.0.1' || 
                      location.hostname.startsWith('192.168.');
        
        if (!isDev) {
            console.log('üîê –ó–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
            
            document.addEventListener('contextmenu', e => e.preventDefault());
            
            document.addEventListener('keydown', e => {
                if (e.ctrlKey && (e.key === 'u' || e.key === 's' || e.key === 'c')) {
                    e.preventDefault();
                }
                if (e.key === 'F12') {
                    e.preventDefault();
                }
            });
            
            document.addEventListener('copy', e => e.preventDefault());
            
            setInterval(() => {
                const start = performance.now();
                debugger;
                const end = performance.now();
                if (end - start > 100) {
                    alert('‚ö†Ô∏è Developer Tools –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã!');
                    window.location.reload();
                }
            }, 1000);
        } else {
            console.log('üõ†Ô∏è –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ - –∑–∞—â–∏—Ç–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞');
        }
    </script>
</body>
</html>
